# Feature Specification: Topology Hover Information Display

**Feature Branch**: `002-topology-hover-info`
**Created**: 2025-11-21
**Status**: Draft
**Input**: User description: "ネットワークトポロジー表示した際、ネットワーク機器やリンクにマウスカーソルを当てるとその情報が表示されること。"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - Device Information on Hover (Priority: P1)

ネットワークエンジニアがトポロジー図上のネットワーク機器ノードにマウスカーソルを当てると、その機器の主要情報（ホスト名、機器タイプ、ベンダー、インターフェース数等）がツールチップまたはポップアップで表示され、詳細画面に遷移せずに基本情報を素早く確認できる。

**Why this priority**: トポロジー図を見ながら各機器の情報を素早く確認できることは、ネットワーク構造の理解とトラブルシューティングにおいて最も頻繁に使われる基本機能。これがないと、毎回詳細画面を開く必要があり作業効率が大幅に低下する。

**Independent Test**: トポロジー図を表示し、任意のデバイスノードにマウスカーソルを当てると、そのデバイスのBatfish情報（ホスト名、ベンダー、機器タイプ等）がツールチップとして表示されることで検証可能。

**Acceptance Scenarios**:

1. **Given** トポロジー図が表示されている、**When** ユーザーがデバイスノードにマウスカーソルを当てる、**Then** 0.5秒以内にツールチップが表示され、ホスト名、ベンダー、機器タイプ、アクティブインターフェース数が表示される
2. **Given** デバイス情報のツールチップが表示されている、**When** ユーザーがマウスカーソルを別のノードに移動する、**Then** 前のツールチップが非表示になり、新しいノードのツールチップが表示される
3. **Given** デバイス情報のツールチップが表示されている、**When** ユーザーがマウスカーソルをトポロジー図の空白領域に移動する、**Then** ツールチップが非表示になる
4. **Given** Batfishから取得できる情報が限定的なデバイスがある、**When** そのデバイスにマウスカーソルを当てる、**Then** 利用可能な情報のみが表示され、「情報なし」または「N/A」が不足情報として表示される

---

### User Story 2 - Link Information on Hover (Priority: P2)

ネットワークエンジニアがトポロジー図上のリンク（エッジ）にマウスカーソルを当てると、そのリンクの詳細情報（接続元・先のインターフェース名、IPアドレス、VLAN、リンクステータス等）がツールチップで表示され、接続関係を素早く把握できる。

**Why this priority**: デバイス間の接続の詳細（どのインターフェース同士が接続されているか、どのVLANか等）は、ネットワーク設定の検証とトラブルシューティングにおいて重要。デバイス情報の次に重要な情報。

**Independent Test**: トポロジー図を表示し、任意のリンクにマウスカーソルを当てると、そのリンクの接続元・先インターフェース情報とネットワーク属性がツールチップとして表示されることで検証可能。

**Acceptance Scenarios**:

1. **Given** トポロジー図が表示されている、**When** ユーザーがリンク（エッジ線）にマウスカーソルを当てる、**Then** 0.5秒以内にツールチップが表示され、接続元デバイス名・インターフェース名、接続先デバイス名・インターフェース名が表示される
2. **Given** リンク情報のツールチップが表示されている、**When** そのリンクに関連するIPアドレスやVLAN情報が存在する、**Then** ツールチップにIPアドレス、VLAN ID、リンクステータス（active/inactive）も表示される
3. **Given** リンク情報のツールチップが表示されている、**When** ユーザーがマウスカーソルを別のリンクまたはノードに移動する、**Then** 前のツールチップが非表示になり、新しい対象のツールチップが表示される
4. **Given** Layer 3エッジとして情報が限定的なリンクがある、**When** そのリンクにマウスカーソルを当てる、**Then** 利用可能な情報のみが表示され、不足情報は表示されない

---

### User Story 3 - Hover Information Customization (Priority: P3)

ネットワークエンジニアがツールチップに表示される情報項目をカスタマイズし、自分の作業に必要な情報（例: BGP情報、OSPF情報、セキュリティゾーン等）を優先的に表示できる。

**Why this priority**: 基本的なホバー情報表示機能があれば価値は提供できるが、ユーザーの作業内容や重視する情報は異なるため、カスタマイズ機能があればさらに効率が向上する。ただし、P1/P2が実装されていれば十分に有用。

**Independent Test**: 設定画面またはプリファレンス画面でツールチップ表示項目をカスタマイズし、トポロジー図でホバーすると選択した項目のみが表示されることで検証可能。

**Acceptance Scenarios**:

1. **Given** ユーザーが設定画面を開いている、**When** ツールチップ表示項目の設定オプションにアクセスする、**Then** デバイス情報とリンク情報それぞれについて、表示可能な項目の一覧（チェックボックス形式）が表示される
2. **Given** ユーザーが表示項目をカスタマイズして保存した、**When** トポロジー図でデバイスまたはリンクにマウスカーソルを当てる、**Then** カスタマイズされた項目のみがツールチップに表示される
3. **Given** ユーザーがすべての表示項目を無効化した、**When** トポロジー図でデバイスまたはリンクにマウスカーソルを当てる、**Then** ツールチップは表示されない、または最低限の識別情報（ホスト名のみ等）が表示される

---

### Edge Cases

- ツールチップが画面端に表示される場合、画面内に収まるように表示位置を自動調整する
- 非常に長いホスト名やインターフェース名が含まれる場合、ツールチップ内で適切に折り返すか省略表示（...）する
- マウスカーソルが高速で複数のノード/リンク上を移動する場合、ツールチップのちらつきを防ぐために表示遅延（0.5秒程度）を設ける
- Batfishから情報が取得できない、またはスナップショット解析中のデバイス/リンクにマウスカーソルを当てた場合、「情報読み込み中」または「情報なし」を表示する
- トポロジー図が大規模（100台以上）でノード/リンクが密集している場合、マウスカーソルの対象を正確に判定し、意図した要素のツールチップを表示する

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムはトポロジー図上のデバイスノードにマウスカーソルが当たったことを検知し、0.5秒以内にツールチップを表示しなければならない
- **FR-002**: デバイスのツールチップには、最低限ホスト名、ベンダー名、機器タイプ、アクティブインターフェース数を含めなければならない
- **FR-003**: システムはトポロジー図上のリンク（エッジ）にマウスカーソルが当たったことを検知し、0.5秒以内にツールチップを表示しなければならない
- **FR-004**: リンクのツールチップには、最低限接続元デバイス名・インターフェース名、接続先デバイス名・インターフェース名を含めなければならない
- **FR-005**: リンクのツールチップには、利用可能な場合、IPアドレス、VLAN ID、リンクステータス（active/inactive）も表示しなければならない
- **FR-006**: システムはマウスカーソルが対象から離れた際、ツールチップを即座に非表示にしなければならない
- **FR-007**: ツールチップは画面端に表示される場合、画面内に収まるように表示位置を自動調整しなければならない
- **FR-008**: システムは長いテキスト（ホスト名、インターフェース名等）を適切に折り返すか省略表示（...）し、ツールチップが過度に大きくならないようにしなければならない
- **FR-009**: システムはBatfishから取得した情報をツールチップに表示し、情報が取得できない項目は「N/A」または非表示としなければならない
- **FR-010**: システムはユーザーがツールチップ表示項目をカスタマイズできる設定インターフェースを提供しなければならない
- **FR-011**: カスタマイズされたツールチップ表示設定は永続化され、次回起動時にも適用されなければならない
- **FR-012**: システムは高速なマウス移動時にツールチップのちらつきを防ぐために、表示遅延メカニズムを実装しなければならない

### Key Entities

- **Device Tooltip Data**: デバイスのツールチップ表示用データ。ホスト名、ベンダー、機器タイプ、インターフェース数、追加カスタマイズ項目を含む
- **Link Tooltip Data**: リンクのツールチップ表示用データ。接続元/先デバイス名、接続元/先インターフェース名、IPアドレス、VLAN ID、ステータスを含む
- **Tooltip Display Preferences**: ユーザーのツールチップ表示設定。デバイス情報の表示項目、リンク情報の表示項目、表示遅延時間等を含む

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: ユーザーはデバイスノードにマウスカーソルを当ててから0.5秒以内にデバイス情報を確認できる
- **SC-002**: ユーザーはリンクにマウスカーソルを当ててから0.5秒以内にリンク情報を確認できる
- **SC-003**: ツールチップ表示により、デバイス詳細画面への遷移回数が50%削減される
- **SC-004**: 50台のデバイスを含むトポロジー図で、任意のノード/リンクにマウスカーソルを当てても応答遅延なく情報が表示される
- **SC-005**: ツールチップは常に画面内に表示され、画面端でのはみ出しは0件となる
- **SC-006**: ユーザーの90%がツールチップから必要な情報を取得でき、詳細画面を開かずに作業を完了できる
- **SC-007**: カスタマイズ設定は次回起動時に100%保持され、再設定の必要がない
- **SC-008**: ネットワーク検証作業において、情報確認時間が従来の詳細画面遷移方式と比較して60%短縮される

## Assumptions

- この機能は既存のトポロジー可視化機能（Feature 001）が実装済みであることを前提とする
- Batfishから取得できるデバイス/リンク情報は、スナップショット作成時に解析済みであると仮定する
- ツールチップ表示はWebブラウザまたはデスクトップアプリケーションのUIフレームワークが提供する標準的なツールチップ機能を拡張して実装されると仮定する
- マウスカーソル操作が可能なデスクトップ環境またはタブレット環境を想定し、タッチ専用デバイスでは代替操作（タップ＆ホールド等）を提供すると仮定する
- ツールチップに表示する情報量は、一般的な画面解像度（1920x1080以上）で読みやすいサイズに収まる範囲とする
