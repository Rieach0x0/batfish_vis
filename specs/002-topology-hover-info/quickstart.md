# Quickstart: Topology Hover Information Display

**Feature**: 002-topology-hover-info
**Purpose**: ツールチップ機能の使用方法とカスタマイズ手順

## Prerequisites

このfeatureはFeature 001 (Batfish Snapshot & Topology Visualization) が実装済みであることが前提です。

**必要なもの:**
- Feature 001が動作しており、トポロジー図が表示できる
- Batfishスナップショットが作成済み
- 対応ブラウザ: Chrome 100+, Firefox 100+, Safari 15+, Edge 100+

## Basic Usage: デバイス情報をホバーで確認

### Step 1: トポロジー図を表示

Feature 001の手順に従ってトポロジー図を表示します。

```bash
# バックエンド起動（例）
cd backend
python -m uvicorn main:app --reload

# ブラウザで開く
open http://localhost:8000/topology
```

### Step 2: デバイスノードにマウスカーソルを当てる

トポロジー図上のデバイスノード（円または四角形のアイコン）にマウスカーソルを当てると、**0.3秒後**にツールチップが表示されます。

**表示される情報（デフォルト）:**
- ホスト名（例: `core-router-1`）
- ベンダー名（例: `CISCO`）
- 機器タイプ（例: `ROUTER`）
- アクティブインターフェース数（例: `24`）

**ツールチップの動作:**
- マウスカーソルをノードから離すと即座に非表示になります
- 別のノードに移動すると、前のツールチップが非表示になり新しいツールチップが表示されます
- トポロジー図の空白領域に移動するとツールチップが非表示になります

### Step 3: リンク情報をホバーで確認

トポロジー図上のリンク（デバイス間を結ぶ線）にマウスカーソルを当てると、**0.3秒後**にツールチップが表示されます。

**表示される情報（デフォルト）:**
- 接続元デバイス名・インターフェース名（例: `core-router-1 / GigabitEthernet0/0/1`）
- 接続先デバイス名・インターフェース名（例: `distribution-switch-2 / TenGigabitEthernet1/0/24`）
- IPアドレス（利用可能な場合）
- VLAN ID（利用可能な場合）
- リンクステータス（`ACTIVE` または `INACTIVE`）

## Advanced Usage: ツールチップ表示をカスタマイズ

### Step 1: 設定画面を開く

トポロジー画面右上の「設定」ボタンまたは歯車アイコンをクリックします。

```
Topology Visualization
┌─────────────────────────────┐
│  [設定 ⚙️]                   │
│                             │
│   ○ Device1   ○ Device2    │
│      │           │          │
│      └───────────┘          │
└─────────────────────────────┘
```

### Step 2: ツールチップ表示項目を選択

設定画面の「ツールチップ設定」セクションで、表示したい項目をチェックボックスで選択します。

**デバイス情報の表示項目:**
- [x] ホスト名（必須、無効化不可）
- [x] ベンダー名
- [x] 機器タイプ
- [x] インターフェース数
- [ ] 機器モデル
- [ ] OSバージョン
- [ ] 管理IPアドレス
- [ ] 物理ロケーション

**リンク情報の表示項目:**
- [x] 接続元デバイス・インターフェース（必須、無効化不可）
- [x] 接続先デバイス・インターフェース（必須、無効化不可）
- [x] IPアドレス
- [x] VLAN ID
- [x] リンクステータス
- [ ] 帯域幅

### Step 3: 表示遅延を調整（オプション）

「表示遅延」スライダーで、マウスカーソルを当ててからツールチップが表示されるまでの時間を調整できます。

- **0秒**: 即座に表示（ちらつきやすい）
- **0.3秒**: デフォルト（推奨）
- **1秒**: ゆっくり表示（意図的なホバーのみ反応）
- **2秒**: 最大遅延

### Step 4: 設定を保存

「保存」ボタンをクリックすると、設定がブラウザのlocalStorageに保存されます。次回ブラウザを開いた際にも同じ設定が適用されます。

### 設定をリセット

「デフォルトに戻す」ボタンをクリックすると、すべての設定が初期状態に戻ります。

## Troubleshooting

### ツールチップが表示されない

**原因1**: Batfishスナップショットが作成されていない
- **解決策**: Feature 001の手順でスナップショットを作成してください

**原因2**: ブラウザのlocalStorageでツールチップが無効化されている
- **解決策**: 設定画面を開き、「デバイス情報ツールチップ」と「リンク情報ツールチップ」が有効になっているか確認

**原因3**: JavaScript エラーが発生している
- **解決策**: ブラウザの開発者ツール（F12）でConsoleタブを開き、エラーメッセージを確認

### ツールチップが画面外にはみ出す

通常は自動で画面内に調整されますが、極端に長いホスト名やインターフェース名が含まれる場合にまれに発生します。

**解決策**: 設定画面で「ツールチップ最大幅」を小さくする（デフォルト400px → 300pxに変更）

### ツールチップの情報が古い

Batfishスナップショットを再作成した後、ブラウザをリロード（F5）してキャッシュをクリアしてください。

**完全なキャッシュクリア**:
- Chrome/Edge: `Ctrl+Shift+Delete` → 「キャッシュされた画像とファイル」をクリア
- Firefox: `Ctrl+Shift+Delete` → 「キャッシュ」をクリア
- Safari: `Cmd+Option+E`

### 設定が保存されない

**原因**: ブラウザのプライベートモード（シークレットモード）ではlocalStorageが無効化されている場合があります。

**解決策**: 通常モードのブラウザを使用してください。

## Performance Tips

### 大規模トポロジー（100台以上のデバイス）での推奨設定

- **表示遅延**: 0.5秒に設定（誤ホバーを防ぐ）
- **表示項目**: 必要最小限に絞る（デフォルトの4〜6項目推奨）
- **ブラウザ**: Chrome または Edgeを使用（Firefoxはやや遅い場合あり）

### メモリ使用量を抑える

ツールチップデータは自動的にキャッシュされますが、最大50ノード分のみメモリに保持されます。それ以上のノードにホバーした場合、古いキャッシュから自動的に削除されます（LRUキャッシュ）。

## Development & Debugging

### デバッグモードの有効化

ブラウザのConsoleで以下を実行すると、ツールチップのデバッグ情報が表示されます：

```javascript
window.TOOLTIP_DEBUG = true;
```

**表示される情報:**
- ホバーイベント詳細（対象ノード/エッジID、Batfishデータ）
- ツールチップポジション計算パラメータ
- パフォーマンスメトリクス（イベント処理時間、描画時間）

**デバッグモードの無効化:**
```javascript
window.TOOLTIP_DEBUG = false;
```

### ツールチップ設定のJSON確認

ブラウザのConsoleで以下を実行すると、現在のツールチップ設定がJSON形式で表示されます：

```javascript
console.log(localStorage.getItem('batfish_tooltip_prefs'));
```

### ツールチップ設定の手動編集（上級者向け）

ブラウザのConsoleで直接localStorageを編集できます：

```javascript
const prefs = {
  "version": "1.0",
  "tooltipPreferences": {
    "device": {
      "enabled": true,
      "fields": ["hostname", "vendor", "osVersion"],
      "customFields": []
    },
    "link": {
      "enabled": true,
      "fields": ["sourceDevice", "sourceInterface", "destDevice", "destInterface"],
      "customFields": []
    },
    "display": {
      "delayMs": 500,
      "maxWidth": 300,
      "theme": "dark"
    }
  }
};
localStorage.setItem('batfish_tooltip_prefs', JSON.stringify(prefs));
location.reload(); // 設定を反映
```

## Next Steps

- **Feature 001 Quickstart**: トポロジー可視化の基本操作を確認
- **data-model.md**: ツールチップデータモデルの詳細を確認
- **research.md**: 実装の技術的背景を確認

## Summary

| 操作 | 方法 | 結果 |
|------|------|------|
| デバイス情報表示 | ノードにマウスカーソルを当てる | 0.3秒後にツールチップ表示 |
| リンク情報表示 | エッジにマウスカーソルを当てる | 0.3秒後にツールチップ表示 |
| 設定カスタマイズ | 設定画面で表示項目を選択 | localStorage に永続化 |
| 設定リセット | 「デフォルトに戻す」ボタン | 初期設定に戻る |
| デバッグ | `window.TOOLTIP_DEBUG = true` | Consoleに詳細情報表示 |
